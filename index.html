<!doctype html>
<!-- 
    Handcrafted using impress.js!
-->
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Keep on delivering with Sitecore Azure</title>
    <meta name="author" content="Kern Herskind Nightingale" />
    <link href="css/impress-demo.css" rel="stylesheet" />
    <link href="css/highlight/monokai_sublime.css" rel="stylesheet" />
</head>
<body class="impress-not-supported">
    <div class="fallback-message">
        <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
        <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
    </div>

    <div id="impress">

        <div id="begin" class="step" data-x="0" data-y="0">
            <img src="images/title.png" width="900" alt="title slide" />
        </div>

        <div class="step" data-x="0" data-y="1000">
            <div class="header">
                What is this presentation about?
            </div>
            <div class="undercontent">
                <p>
					This presentation will describe an approach to using Sitecore Azure within a continous delivery pipeline.
                </p>
                <p>
                    <br />
					This is not about Continuous Delivery/Deployment, but about how Sitecore Azure fits into those methodologies
                </p>
            </div>
        </div>

        <div class="step" data-x="0" data-y="2000">
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                1) ARCHITECTURE<br />
                <span class="muted">
                    2) CODE<br />
                    3) DISCO
                </span>
            </p>
        </div>

        <div class="step" data-x="0" data-y="3000">
            <p style="text-align:center; line-height: 1; font-size: 60px;">
                <img src="images/sitecore-azure-architecture.png" width="100%" /><br />
                Example Architecture with Sitecore Azure
            </p>
        </div>

        <div class="step" data-x="0" data-y="4000">
			<div class="headersq">
                <div class="outerContainer"><div class="innerContainer">Where does this fit?</div></div>
            </div>
            <div class="rightcontent">
                <p>
                    Deployment continues <span class="attention">as normal</span>, up to the Content Management server that has the Sitecore Azure module installed. 
                </p>
            </div>
        </div>

        <div class="step" data-x="-1000" data-y="5000">
			<div class="rightcontent">
                <p>
                    Once code and content is deployed to Content Management, then the Sitecore Azure module is invoked via HTTP Requests to start the deployment process, and later the role swap process. 
                </p>
            </div>
			<div class="headersq">
                <div class="outerContainer"><div class="innerContainer">What Our Code Will Do?</div></div>
            </div>
        </div>

        <div class="step" data-x="1000" data-y="5000">
            <p style="text-align:center; line-height: 1; font-size: 80px;">
                <img src="images/sitecore-azure-deploy.png" width="100%" /><br />
                Sitecore Azure Deployment and Swap
            </p>
        </div>

        <div class="step" data-x="3000" data-y="5000">
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                <span class="muted">
					1) ARCHITECTURE<br />
                </span>
                    2) CODE<br />
				<span class="muted">
                    3) DISCO
                </span>
            </p>
        </div>

        <div class="step" data-x="3300" data-y="4000" data-z="0">
            <div class="headersq">
                <div class="outerContainer"><div class="innerContainer">Adding a Service for Sitecore Azure</div></div>
            </div>
            <div class="rightcontent">
                <p>
                    We require a Sitecore context to run the Sitecore Azure commands, therefore we need to intercept HTTP requests. 
					When invoked, the service will find deployments for given subscription, and call 'Upgrade Files' command.
                </p>
            </div>
        </div>

        <div class="step" data-x="3500" data-y="3000" data-rotate-z="15" data-z="-500">
            <pre>
            <code class="cs">
public AzureDeployments GetDeployments()
{

	var azureDeployments = new AzureDeployments {
		SubscriptionId = _configurationProvider.Settings.SubscriptionId
	};

	//Get list of environments
	IEnumerable<Sitecore.Azure.Deployments.Environments.Environment> environments =
		Sitecore.Azure.Deployments.Environments.Environment.GetEnvironments(azureDeployments.SubscriptionId);

	if (environments != null)
	{
		foreach (var environment in environments)
		{
			//Create new environment
			var azureEnvironment = new AzureEnvironment { 
			EnvironmentId = environment.EnvironmentId, 
			Environment = environment.DisplayName };

			foreach (var deployment in environment.GetDeployments())
			{
				//Add deployment to collection
				azureEnvironment.Deployment.Add(
					new AzureDeployment
						{
							DeploymentId = deployment.ID.ToString(),
							Location = deployment.WebRole.Farm.Location.Name,
							DeploymentName = deployment.DisplayName,
							DeploymentType = deployment.DeploymentType.ToString(),
							DeploymentSlot = deployment.DeploymentSlot.ToString(),
							HostedServiceName = deployment.HostedServiceName,
							Databases = deployment.DatabaseReferences.DisplayName
						});
			}

			//Add environment to collection
			azureDeployments.Deployments.Add(azureEnvironment);

		}

	}
	else
	{
		//Log action
		Log.Info(string.Format("No deployments found for Subscription ID : {0}", 
		_configurationProvider.Settings.SubscriptionId), this);
	}

	return azureDeployments;
}
            </code>
            </pre>
        </div>
		
		<div class="step evolve" data-x="3500" data-y="3000" data-rotate-z="15" data-z="-500">
            <pre>
            <code class="cs">
public AzureDeployments GetDeployments()
{

	var azureDeployments = new AzureDeployments {
		SubscriptionId = <span class="attention">_configurationProvider.Settings.SubscriptionId</span>
	};

	//Get list of environments
	IEnumerable<Sitecore.Azure.Deployments.Environments.Environment> environments =
		<span class="attention">Sitecore.Azure.Deployments.Environments.Environment.GetEnvironments(azureDeployments.SubscriptionId);</span>

	if (environments != null)
	{
		foreach (var environment in environments)
		{
			//Create new environment
			var azureEnvironment = new AzureEnvironment { 
			EnvironmentId = environment.EnvironmentId, 
			Environment = environment.DisplayName };

			foreach (var deployment in environment.GetDeployments())
			{
				//Add deployment to collection
				azureEnvironment.Deployment.Add(
					new AzureDeployment
						{
							DeploymentId = deployment.ID.ToString(),
							Location = deployment.WebRole.Farm.Location.Name,
							DeploymentName = deployment.DisplayName,
							DeploymentType = deployment.DeploymentType.ToString(),
							DeploymentSlot = deployment.DeploymentSlot.ToString(),
							HostedServiceName = deployment.HostedServiceName,
							Databases = deployment.DatabaseReferences.DisplayName
						});
			}

			//Add environment to collection
			azureDeployments.Deployments.Add(azureEnvironment);

		}

	}
	else
	{
		//Log action
		Log.Info(string.Format("No deployments found for Subscription ID : {0}", 
		_configurationProvider.Settings.SubscriptionId), this);
	}

	return azureDeployments;
}
            </code>
            </pre>
        </div>

        <div class="step" data-x="5300" data-y="3300" data-rotate-z="90" data-z="-1500">
            <pre>
            <code class="cs">
public void UpdateFiles()
{
	//If no subscriptionId passed in parameters then use configuration provided id
	var subscriptionId = _configurationProvider.Settings.SubscriptionId;

	//Get list of environments
	IEnumerable<Sitecore.Azure.Deployments.Environments.Environment> environments =
		Sitecore.Azure.Deployments.Environments.Environment.GetEnvironments(subscriptionId);

	//Loop through environments and deployments
	foreach (var deployment in environments.SelectMany(environment => AzureDeploymentManager.Current.GetDeployments(environment)))
	{
		AzureDeploymentManager.Current.UpgradeDeploymentAsync(deployment);

		Log.Info(string.Format("Updated deployment : {0}", deployment.DisplayName), this);
	}
}
            </code>
            </pre>
        </div>
		
        <div class="step evolve" data-x="5300" data-y="3300" data-rotate-z="90" data-z="-1500">
            <pre>
            <code class="cs">
public void UpdateFiles()
{
	//If no subscriptionId passed in parameters then use configuration provided id
	var subscriptionId = _configurationProvider.Settings.SubscriptionId;

	//Get list of environments
	IEnumerable<Sitecore.Azure.Deployments.Environments.Environment> environments =
		<span class="attention">Sitecore.Azure.Deployments.Environments.Environment.GetEnvironments(subscriptionId)</span>;

	//Loop through environments and deployments
	foreach (var deployment in environments.SelectMany(environment => AzureDeploymentManager.Current.GetDeployments(environment)))
	{
		<span class="attention">AzureDeploymentManager.Current.UpgradeDeploymentAsync(deployment)</span>;

		Log.Info(string.Format("Updated deployment : {0}", deployment.DisplayName), this);
	}
}
            </code>
            </pre>
        </div>
		
		<div class="step" data-x="7300" data-y="3300" data-rotate-z="90" data-z="-1500">
            <pre>
            <code class="cs">
	public void SwapDeployments()
	{
		//If no subscriptionId passed in parameters then use configuration provided id
		var subscriptionId = _configurationProvider.Settings.SubscriptionId;

		//Get list of environments
		IEnumerable<Sitecore.Azure.Deployments.Environments.Environment> environments =
			Sitecore.Azure.Deployments.Environments.Environment.GetEnvironments(subscriptionId);

		//Loop through environments and deployments
		foreach (var deployment in environments.SelectMany(environment => AzureDeploymentManager.Current.GetDeployments(environment)))
		{
			AzureDeploymentManager.Current.SwapAsync(deployment);

			Log.Info(string.Format("Swapped deployment : {0}", deployment.DisplayName), this);
		}
	}
            </code>
            </pre>
        </div>

		<div class="step evolve" data-x="7300" data-y="3300" data-rotate-z="90" data-z="-1500">
            <pre>
            <code class="cs">
	public void SwapDeployments()
	{
		//If no subscriptionId passed in parameters then use configuration provided id
		var subscriptionId = _configurationProvider.Settings.SubscriptionId;

		//Get list of environments
		IEnumerable<Sitecore.Azure.Deployments.Environments.Environment> environments =
			Sitecore.Azure.Deployments.Environments.Environment.GetEnvironments(subscriptionId);

		//Loop through environments and deployments
		foreach (var deployment in environments.SelectMany(environment => AzureDeploymentManager.Current.GetDeployments(environment)))
		{
			<spam class="attention">AzureDeploymentManager.Current.SwapAsync(deployment)</span>;

			Log.Info(string.Format("Swapped deployment : {0}", deployment.DisplayName), this);
		}
	}
            </code>
            </pre>
        </div>
		
		<div class="step" data-x="9300" data-y="3300">
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                <span class="muted">
					1) ARCHITECTURE<br />

                    2) CODE<br />
                </span>
                    3) DISCO
            </p>
        </div>

        <div class="step" data-x="6500" data-y="7000" data-z="1000">
            <p style="text-align:center; line-height: 1; font-size: 60px;">
                <img src="images/disco.png" width="60%" height="60%" /><br />
                Deployment Success!
            </p>
        </div>

        <div class="step" data-x="8500" data-y="5000" data-z="150">
            <div class="headersq">
                <div class="outerContainer"><div class="innerContainer">Facet and Facet Pivet</div></div>
            </div>
            <div class="rightcontent">
                <ul style="list-style: disc; padding-left: 50px; font-size: 80%;">
                    <li>Facets: Predict number of results if you where to filter on a facet whithin current query</li>
                    <li>Pivot Facet: Create decision tree of predictions</li>
                    <li>
                        Note that Sitecore always returns a flat list - imagine a filter on 'category' (id) and 'haspoint' (bool):<br /><img src="images/pivotfacetresult.png" style="height: 400px; margin: 25px 0 0 0;" />
                    </li>
                </ul>

            </div>
        </div>

        <div class="step" data-x="-2000" data-y="2000" data-rotate="180">
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                <span class="muted">
                    1) SEARCH EXAMPLE<br />
                </span>
                2) OFF-PISTE: GEO<br />
                <span class="muted">
                    3) TIPS AND TRICKS
                </span>
            </p>
        </div>

        <div class="step" data-x="-2000" data-y="1000" data-rotate="180">
            <div class="headersq">
                <div class="outerContainer"><div class="innerContainer">Sitecore Lucene Spatial Search</div></div>
            </div>
            <div class="rightcontent">
                <p>Motivation: Sitecore currently does not support spatial queries</p>
                <hr />
                <p>Moving parts:</p>
                <ul style="list-style: disc; padding-left: 50px; font-size: 100%;">
                    <li>ComputedField for generating geohashes</li>
                    <li>Override of LuceneIndex with support for spatial filter and ordering</li>
                    <li>Based on Lucene.Net.Contrib.Spatial</li>
                    <li>Context for specifying parameters - not integrated in LINQ layer :'-(</li>
                </ul>
            </div>
        </div>

        <div class="step" data-x="-2000" data-y="0" data-rotate="150">
            <pre>
            <code class="cs">
var index = ContentSearchManager.GetIndex("sitecore_master_index") <span class="attention">as SpatialLuceneIndex</span>;
using (var context = index.CreateSearchContext() <span class="attention">as SpatialLuceneSearchContext</span>)
{
    if (criteria.PointRadius != null)
    {
            <span class="attention">context.SetGeoFilter</span>(new PointRadiusCriterion()
        {
            FieldName = "_geohash",
            RadiusKm = criteria.PointRadius.RadiusKm,
            Latitude = criteria.PointRadius.Latitude,
            Longitude = criteria.PointRadius.Longitude,
            Sort = PointRadiusCriterion.SortOption.Ascending
        });
    }
    var queriable = context.GetQueryable&lt;SearchResultItem&gt;();
    //...
                </code>
            </pre>
            <p style="font-size: 50%;"><a href="https://github.com/herskinduk/Usergroup.Sugnl">See the Usergroup.Sugnl repo on Github</a></p>
        </div>

        <div class="step" data-x="-2000" data-y="-1000" data-rotate="180">
            <div style="width: 45%; height:100%; align-content:center; float:left;">
                <p style="text-align:left; line-height: 1; font-size: 80%">
                    Provided 'as is',
                    results may vary,
                    terms and conditions apply
                </p>
            </div>
            <div style="width: 45%; height:100%; align-content:center; float:right;">
                <p style="text-align:left; line-height: 1; font-size: 80%;">
                    Known issue: Spatial filter does not apply to facet results
                </p>
            </div>
        </div>

        <div class="step" data-x="-4000" data-y="2000" data-rotate="0">
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                <span class="muted">
                    1) SEARCH EXAMPLE<br />
                    2) OFF-PISTE: GEO<br />
                </span>
                3) TIPS AND TRICKS
            </p>
        </div>

        <div class="step" data-x="-4000" data-y="3000">
            <div class="header">
                Tip: LinqPad + Sitecore = &#10084;
            </div>
            <div class="undercontent">
                <p style="text-align:center;">
                    <img src="images/linqpad.png" style="width:100%; " />
                </p>
                <p style="text-align:center; line-height: 1; font-size: 80%;">
                    <a href="http://www.sitecore.net/Community/Technical-Blogs/Getting-to-Know-Sitecore/Posts/2014/03/LINQPad-Driver-for-Sitecore.aspx">See Adam Conn's blog post for more info</a>
                </p>
            </div>
        </div>


        <div class="step" data-x="-4000" data-y="4000" data-rotate="0">
            <pre>
            <code class="cs">
public class MyComputedField : IComputedIndexField
{
    //
    // Tip: Constructor interrogates field configuration to find custom paramaters
    //
    public MyComputedField(XmlNode configNode)
    {
        string sourceFieldName = XmlUtil.GetAttribute("sourceFieldName", configNode, true);
        this.SourceFieldName = sourceFieldName;
    }
    
    public string SourceFieldName { get; set; }
    //...
                </code>
            </pre>
            <p style="font-size: 50%;"><a href="https://github.com/herskinduk/Usergroup.Sugnl">See the Usergroup.Sugnl repo on Github</a></p>
        </div>


        <div class="step" data-x="-2000" data-y="4000" data-rotate="0">
            <pre>
            <code class="cs">
//
// Tip: Turn off Indexing and eventing when bulk loading data into Sitecore
//
Sitecore.Configuration.Settings.Indexing.Enabled = false;
using (new EventDisabler())
{
    //
    // Bulk insertion of items goes here...
    //
}
Sitecore.Configuration.Settings.Indexing.Enabled = true;
                </code>
            </pre>
            <p style="font-size: 50%;"><a href="https://github.com/herskinduk/Usergroup.Sugnl">See the Usergroup.Sugnl repo on Github</a></p>
        </div>

        <div class="step" data-x="-2000" data-y="3000" data-rotate="30">
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                Thanks for listening!
            </p>
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                @herskinduk
            </p>
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                #SUGCON #Sitecore
            </p>
        </div>


        <div class="step" data-x="2000" data-y="0">
            <p><img src="images/last.png" alt="last slide" style="width:100%"/></p>
        </div>

        <div id="overview" class="step" data-x="3000" data-y="1500" data-scale="10">
        </div>

    </div>
    <script src="js/impress.js"></script>
    <script src="js/highlight.pack.js"></script>
    <script>
        impress().init();
        hljs.initHighlightingOnLoad();
    </script>
</body>
</html>
