<!doctype html>
<!-- 
    Handcrafted using impress.js!
-->
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Keep on delivering with Sitecore Azure</title>
    <meta name="author" content="Damian Brooks" />
    <link href="css/impress-demo.css" rel="stylesheet" />
    <link href="css/highlight/monokai_sublime.css" rel="stylesheet" />
</head>
<body class="impress-not-supported">
    <div class="fallback-message">
        <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
        <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
    </div>

    <div id="impress">
			
		<div id="begin" class="step" data-x="0" data-y="-4000">
            <div class="headersq">
                <div class="outerContainer"><div class="innerContainer">AGENDA</div></div>
            </div>
            <div class="rightcontent">
                <p>
                    Tonight shall mostly be the following; <br />
				</p>
				
				<ul>
					<li>6:30 - 'Continuous Delivery with Sitecore Azure' - Damian Brooks</li>
					<li>6:45 - ‘Test driven development’- Navinder Marwaha</li>
					<li>BREAK</li>
					<li>7:30 - ‘Developing for the Adaptive Print Studio’ -  Steve McGill</li>
					<li>8:15 - Quiz and Networking</li>
				</ul>
				
            </div>
        </div>

		<div class="step" data-x="0" data-y="-2000">
            <img src="images/competition.png" width="900" alt="title slide" />
        </div>
	
        <div class="step" data-x="0" data-y="0">
            <img src="images/title.png" width="900" alt="title slide" />
        </div>

        <div class="step" data-x="0" data-y="1000">
            <div class="header">
                What is this presentation about?
            </div>
            <div class="undercontent">
                <p>
					This presentation will describe an approach to using Sitecore Azure within a Continuous Delivery pipeline.
                </p>
                <p>
                    <br />
					<i>This is not about Continuous Delivery/Deployment, but about how Sitecore Azure fits into those methodologies.</i>
                </p>
            </div>
        </div>
		
        <div class="step" data-x="-2000" data-y="1000">
            <p style="text-align:center; line-height: 1; font-size: 60px;">
                <img src="images/cd101.jpg" width="100%" /><br />
				Continuous Delivery 101
            </p>
        </div>

        <div class="step" data-x="0" data-y="2000">
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                1) ARCHITECTURE<br />
                <span class="muted">
                    2) CODE<br />
                    3) TIPS + TRICKS
                </span>
            </p>
        </div>

        <div class="step" data-x="0" data-y="3000">
            <p style="text-align:center; line-height: 1; font-size: 60px;">
                <img src="images/sitecore-azure-architecture.png" width="100%" /><br />
                Example Architecture with Sitecore Azure
            </p>
        </div>

        <div class="step" data-x="0" data-y="4000">
			<div class="headersq">
                <div class="outerContainer"><div class="innerContainer">Where does this topic fit?</div></div>
            </div>
            <div class="rightcontent">
                <p>
                    Deployment continues <span class="attention">as normal</span>, up to the Content Management server that has the Sitecore Azure module installed. 
                </p>
            </div>
        </div>

        <div class="step" data-x="-1000" data-y="5000">
			<div class="rightcontent">
                <p>
                    Once code and content is deployed to the Content Management server, then the Sitecore Azure module is invoked via HTTP Requests to start the deployment process, and later the role swap process. The code provides the HTTP Request interface. 
                </p>
            </div>
			<div class="headersq rightmargin">
                <div class="outerContainer"><div class="innerContainer">What the Code Will Do?</div></div>
            </div>
        </div>

        <div class="step" data-x="1000" data-y="5000">
            <p style="text-align:center; line-height: 1; font-size: 80px;">
                <img src="images/sitecore-azure-deploy.png" width="100%" /><br />
                Sitecore Azure Deployment and Swap
            </p>
        </div>

        <div class="step" data-x="3000" data-y="5000">
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                <span class="muted">
					1) ARCHITECTURE<br />
                </span>
                    2) CODE<br />
				<span class="muted">
                    3) TIPS + TRICKS
                </span>
            </p>
        </div>
		
		<div class="step" data-x="3300" data-y="4000" data-z="1000">
			<div class="rightcontent">
                <p>Sitecore Azure Terminology</p>
                <hr />
                <ul style="list-style: disc; padding-left: 50px; font-size: 80%;">
                    <li><b>Deployment</b> - A Web Role instance</li>
                    <li><b>Upgrade Files</b> - Copy and deploy content from Content Management to Web Role(s)</li>
					<li><b>Swap</b> - Swap Web Role instance(s) from Staging to Production</li>
                </ul>
            </div>
			<div class="headersq rightmargin">
                <div class="outerContainer">
					<div class="innerContainer" style="font-size: 80%;">
						But first, some terminology...
					</div>
				</div>
            </div>
        </div>

        <div class="step" data-x="3300" data-y="4000" data-z="0">
            <div class="headersq">
                <div class="outerContainer"><div class="innerContainer">Adding a Service for Sitecore Azure</div></div>
            </div>
            <div class="rightcontent">
                <p>
                    We require a Sitecore context to run the Sitecore Azure commands, therefore we need to intercept HTTP requests via the HttpRequestBegin pipeline. 
					When invoked, the service will find deployments for given subscription, and call 'Upgrade Files' command.
                </p>
            </div>
        </div>

        <div class="step" data-x="3500" data-y="3000" data-rotate-z="15" data-z="-500">
            <pre>
            <code class="cs" style="font-size: 25%;">
public AzureDeployments GetDeployments()
{

	var azureDeployments = new AzureDeployments {
		SubscriptionId = _configurationProvider.Settings.SubscriptionId
	};

	//Get list of environments
	IEnumerable<Environments.Environment> environments =
		Environments.Environment.GetEnvironments(azureDeployments.SubscriptionId);

	if (environments != null)
	{
		foreach (var environment in environments)
		{
			//Create new environment
			var azureEnvironment = new AzureEnvironment { 
			EnvironmentId = environment.EnvironmentId, 
			Environment = environment.DisplayName };

			foreach (var deployment in environment.GetDeployments())
			{
				//Add deployment to collection
				azureEnvironment.Deployment.Add(
					new AzureDeployment
						{
							DeploymentId = deployment.ID.ToString(),
							Location = deployment.WebRole.Farm.Location.Name,
							DeploymentName = deployment.DisplayName,
							DeploymentType = deployment.DeploymentType.ToString(),
							DeploymentSlot = deployment.DeploymentSlot.ToString(),
							HostedServiceName = deployment.HostedServiceName,
							Databases = deployment.DatabaseReferences.DisplayName
						});
			}

			//Add environment to collection
			azureDeployments.Deployments.Add(azureEnvironment);

		}

	}
	else
	{
		//Log action
		Log.Info(string.Format("No deployments found for Subscription ID : {0}", 
		_configurationProvider.Settings.SubscriptionId), this);
	}

	return azureDeployments;
}
            </code>
            </pre>
        </div>
		
		<div class="step evolve" data-x="3500" data-y="3000" data-rotate-z="15" data-z="-500">
            <pre>
            <code class="cs" style="font-size: 25%;">
public AzureDeployments GetDeployments()
{

	var azureDeployments = new AzureDeployments {
		SubscriptionId = <span class="attention">_configurationProvider.Settings.SubscriptionId</span>
	};

	//Get list of environments
	IEnumerable<Sitecore.Azure.Deployments.Environments.Environment> environments =
		<span class="attention">Sitecore.Azure.Deployments.Environments.Environment.GetEnvironments(azureDeployments.SubscriptionId);</span>

	if (environments != null)
	{
		foreach (var environment in environments)
		{
			//Create new environment
			var azureEnvironment = new AzureEnvironment { 
			EnvironmentId = environment.EnvironmentId, 
			Environment = environment.DisplayName };

			foreach (var deployment in environment.GetDeployments())
			{
				//Add deployment to collection
				azureEnvironment.Deployment.Add(
					new AzureDeployment
						{
							DeploymentId = deployment.ID.ToString(),
							Location = deployment.WebRole.Farm.Location.Name,
							DeploymentName = deployment.DisplayName,
							DeploymentType = deployment.DeploymentType.ToString(),
							DeploymentSlot = deployment.DeploymentSlot.ToString(),
							HostedServiceName = deployment.HostedServiceName,
							Databases = deployment.DatabaseReferences.DisplayName
						});
			}

			//Add environment to collection
			azureDeployments.Deployments.Add(azureEnvironment);

		}

	}
	else
	{
		//Log action
		Log.Info(string.Format("No deployments found for Subscription ID : {0}", 
		_configurationProvider.Settings.SubscriptionId), this);
	}

	return azureDeployments;
}
            </code>
            </pre>
        </div>

        <div class="step" data-x="5300" data-y="3300" data-rotate-z="90" data-z="-1500">
            <pre>
            <code class="cs" style="font-size: 25%;">
public void UpdateFiles()
{
	//If no subscriptionId passed in parameters then use configuration provided id
	var subscriptionId = _configurationProvider.Settings.SubscriptionId;

	//Get list of environments
	IEnumerable<Sitecore.Azure.Deployments.Environments.Environment> environments =
		Sitecore.Azure.Deployments.Environments.Environment.GetEnvironments(subscriptionId);

	//Loop through environments and deployments
	foreach (var deployment in environments.SelectMany(
		environment => AzureDeploymentManager.Current.GetDeployments(environment)))
	{
		AzureDeploymentManager.Current.UpgradeDeploymentAsync(deployment);

		Log.Info(string.Format("Updated deployment : {0}", deployment.DisplayName), this);
	}
}
            </code>
            </pre>
        </div>
		
        <div class="step evolve" data-x="5300" data-y="3300" data-rotate-z="90" data-z="-1500">
            <pre>
            <code class="cs" style="font-size: 25%;">
public void UpdateFiles()
{
	//If no subscriptionId passed in parameters then use configuration provided id
	var subscriptionId = _configurationProvider.Settings.SubscriptionId;

	//Get list of environments
	IEnumerable<Sitecore.Azure.Deployments.Environments.Environment> environments =
		<span class="attention">Sitecore.Azure.Deployments.Environments.Environment.GetEnvironments(subscriptionId)</span>;

	//Loop through environments and deployments
	foreach (var deployment in environments.SelectMany(
		environment => AzureDeploymentManager.Current.GetDeployments(environment)))
	{
		<span class="attention">AzureDeploymentManager.Current.UpgradeDeploymentAsync(deployment)</span>;

		Log.Info(string.Format("Updated deployment : {0}", deployment.DisplayName), this);
	}
}
            </code>
            </pre>
        </div>
		
		<div class="step" data-x="7300" data-y="3300" data-rotate-z="90" data-z="-1500">
            <pre>
            <code class="cs" style="font-size: 25%;">
	public void SwapDeployments()
	{
		//If no subscriptionId passed in parameters then use configuration provided id
		var subscriptionId = _configurationProvider.Settings.SubscriptionId;

		//Get list of environments
		IEnumerable<Sitecore.Azure.Deployments.Environments.Environment> environments =
			Sitecore.Azure.Deployments.Environments.Environment.GetEnvironments(subscriptionId);

		//Loop through environments and deployments
		foreach (var deployment in environments.SelectMany(environment => AzureDeploymentManager.Current.GetDeployments(environment)))
		{
			AzureDeploymentManager.Current.SwapAsync(deployment);

			Log.Info(string.Format("Swapped deployment : {0}", deployment.DisplayName), this);
		}
	}
            </code>
            </pre>
        </div>

		<div class="step evolve" data-x="7300" data-y="3300" data-rotate-z="90" data-z="-1500">
            <pre>
            <code class="cs" style="font-size: 25%;">
	public void SwapDeployments()
	{
		//If no subscriptionId passed in parameters then use configuration provided id
		var subscriptionId = _configurationProvider.Settings.SubscriptionId;

		//Get list of environments
		IEnumerable<Sitecore.Azure.Deployments.Environments.Environment> environments =
			Sitecore.Azure.Deployments.Environments.Environment.GetEnvironments(subscriptionId);

		//Loop through environments and deployments
		foreach (var deployment in environments.SelectMany(environment => AzureDeploymentManager.Current.GetDeployments(environment)))
		{
			<span class="attention">AzureDeploymentManager.Current.SwapAsync(deployment)</span>;

			Log.Info(string.Format("Swapped deployment : {0}", deployment.DisplayName), this);
		}
	}
            </code>
            </pre>
        </div>
		
		<div class="step" data-x="9300" data-y="3300">
            <p style="text-align:center; line-height: 1; font-size: 60px;">
                <img src="images/disco.png" width="60%" height="60%" /><br />
                Deployment Success!
            </p>
        </div>
		
		<div class="step" data-x="6500" data-y="7000" data-z="1000">
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                <span class="muted">
					1) ARCHITECTURE<br />

                    2) CODE<br />
                </span>
                    3) TIPS + TRICKS
            </p>
        </div>



        <div class="step" data-x="8500" data-y="5000" data-z="150">
            <div class="headersq">
                <div class="outerContainer" style="font-size: 80%;"><div class="innerContainer">Alerting and Monitoring Deployments</div></div>
            </div>
            <div class="rightcontent">
				<p style="text-align:center; line-height: 1; font-size: 30px;">
					Sitecore Azure does not provide any alerting out of the box. When used in a CD pipeline, this means that the final deployment could fail (or succeed) without alerting anyone. 
					<br />
				</p>
				<p style="text-align:center; line-height: 1; font-size: 30px;">
					To get around this, add a pipeline processor into the 'UpgradeDeployment' pipeline.
				</p>
            </div>
        </div>
		
		<div class="step" data-x="10000" data-y="6000" data-rotate="180">
            <pre>
            <code class="xml" style="font-size: 25%;">
				&lt;UpgradeDeployment patch:source="Sitecore.Azure.config"&gt;
					&lt;processor type="Sitecore.Azure.Pipelines.DeployAndRun.Azure.ResolveSources, Sitecore.Azure"/&gt;
					&lt;processor type="Sitecore.Azure.Pipelines.DeployAndRun.Azure.CreatePackage, Sitecore.Azure"/&gt;
					&lt;processor type="Sitecore.Azure.Pipelines.DeployAndRun.Azure.Upload, Sitecore.Azure"/&gt;
					&lt;processor type="Sitecore.Azure.Pipelines.UpgradeDeployment.Upgrade, Sitecore.Azure"/&gt;
					&lt;processor type="Sitecore.Azure.Pipelines.UpgradeDeployment.WaitForInitialization, Sitecore.Azure"/&gt;
					&lt;processor type="Sitecore.Azure.Pipelines.DeployAndRun.Azure.Finalize, Sitecore.Azure"/&gt;
					<span class="attention">Add processor for monitoring here</span>
				&lt;/UpgradeDeployment&gt;
            </code>
            </pre>
        </div>
		
		<div class="step" data-x="9000" data-y="7000" data-rotate="150">
            <pre>
            <code class="cs" style="font-size: 25%;">
				&lt;SwapAzureDeployment patch:source="Sitecore.Azure.config"&gt;
					&lt;processor type="Sitecore.Azure.Pipelines.SwapAzureDeployment.SwapAzureDeployment, Sitecore.Azure"/&gt;
					<span class="attention">Add processor for monitoring here</span>
				&lt;/SwapAzureDeployment&gt;
            </code>
            </pre>
        </div>

        <div class="step" data-x="-2000" data-y="3000" data-rotate="30">
            <p style="text-align:left; line-height: 1; font-size: 90px;">
                Thanks for listening!
            </p>
            <p style="text-align:left; line-height: 1; font-size: 50px;">
                @brooksyd2dbs
            </p>
            <p style="text-align:left; line-height: 1; font-size: 50px;">
                dbs@sitecore.net
            </p>
        </div>

    </div>
    <script src="js/impress.js"></script>
    <script src="js/highlight.pack.js"></script>
    <script>
        impress().init();
        hljs.initHighlightingOnLoad();
    </script>
</body>
</html>
